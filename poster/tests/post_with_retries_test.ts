import {postWithRetries, signAndSend} from '../src/postWithRetries';
const Web3 = require('web3');
require('sepia');

describe('posting', () => {
  test('signs and sends', async () => {
    const provider = "http://localhost:8545";
    const web3 = await new Web3(provider);
    let senderKey = "0xcf1eebe7f2053fd82c1ee6dff3b7e4a46820049ec5ff1abc036abd439b88167e"

    // sends the transaction
    const data = "0xa59d56ad000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000020177ee777e72b8c042e05ef41d1db0f17f1fcb0e8150b37cfad6993e4373bdf1000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000006004a78a7b3013f6939da19eac6fd1ad5c5a20c41bcc5d828557442aad6f07598d029ae684620bec13e13d018cba0da5096626e83cfd4d5356d808d7437a0a5076000000000000000000000000000000000000000000000000000000000000001c"

    try {
    let receipt = await signAndSend({
      data: data,
      to: "0xbF380fD4776f6107Ae869270d1AEB90164589128",
      gasPrice: 10_000_000,
      gas: 100_000,
      chainId: "0x" + Number(1337).toString(16)
    }, senderKey, provider);


      expect(receipt).toEqual([]);
    }
      catch(e) {
        console.log(e)
        // TODO: post a valid message after we finalize the view
        // console.log(e)
      }
  });
});
